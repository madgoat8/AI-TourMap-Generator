# AI-TourMap-Generator æ¨¡å‹ä¸‹è½½æŒ‡å—

> æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»å¦‚ä½•å¿«é€Ÿã€ç¨³å®šåœ°ä¸‹è½½é¡¹ç›®æ‰€éœ€çš„AIæ¨¡å‹ï¼Œç‰¹åˆ«é’ˆå¯¹å›½å†…ç½‘ç»œç¯å¢ƒè¿›è¡Œäº†ä¼˜åŒ–ã€‚

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [é•œåƒæºé…ç½®](#é•œåƒæºé…ç½®)
- [ä¸‹è½½å·¥å…·ä½¿ç”¨](#ä¸‹è½½å·¥å…·ä½¿ç”¨)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [ç¦»çº¿éƒ¨ç½²](#ç¦»çº¿éƒ¨ç½²)
- [é«˜çº§é…ç½®](#é«˜çº§é…ç½®)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•ä¸€ï¼šä¸€é”®ä¸‹è½½ï¼ˆæ¨èï¼‰

```bash
# Windows ç”¨æˆ·
download_models.bat

# Linux/Mac ç”¨æˆ·
python download_models.py
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨é…ç½®

```bash
# 1. é…ç½®å›½å†…é•œåƒ
python setup_mirror.py hf-mirror

# 2. ä¸‹è½½æ¨¡å‹
python download_models.py

# 3. éªŒè¯ä¸‹è½½
python setup_mirror.py test
```

## ğŸŒ é•œåƒæºé…ç½®

### å¯ç”¨é•œåƒæº

| é•œåƒåç§° | åœ°å€ | ç‰¹ç‚¹ | æ¨èæŒ‡æ•° |
|---------|------|------|---------|
| **hf-mirror** | https://hf-mirror.com | ğŸ”¥ å›½å†…ä¼˜åŒ–ï¼Œé€Ÿåº¦æœ€å¿« | â­â­â­â­â­ |
| **modelscope** | https://www.modelscope.cn | é˜¿é‡Œäº‘é•œåƒï¼Œç¨³å®šæ€§å¥½ | â­â­â­â­ |
| **official** | https://huggingface.co | å®˜æ–¹æºï¼Œæœ€æ–°æœ€å…¨ | â­â­â­ |

### é•œåƒé…ç½®æ–¹æ³•

#### è‡ªåŠ¨é€‰æ‹©æœ€ä½³é•œåƒ
```bash
python setup_mirror.py auto
```

#### æ‰‹åŠ¨æŒ‡å®šé•œåƒ
```bash
# ä½¿ç”¨ hf-mirrorï¼ˆæ¨èï¼‰
python setup_mirror.py hf-mirror

# ä½¿ç”¨ modelscope
python setup_mirror.py modelscope

# ä½¿ç”¨å®˜æ–¹æº
python setup_mirror.py official
```

#### æµ‹è¯•é•œåƒè¿é€šæ€§
```bash
python setup_mirror.py test
```

## ğŸ› ï¸ ä¸‹è½½å·¥å…·ä½¿ç”¨

### æ ¸å¿ƒè„šæœ¬è¯´æ˜

#### `download_models.py` - ä¸»ä¸‹è½½è„šæœ¬
- **åŠŸèƒ½**: ä¸‹è½½é¡¹ç›®æ‰€éœ€çš„æ‰€æœ‰AIæ¨¡å‹
- **ç‰¹æ€§**: 
  - âœ… æ–­ç‚¹ç»­ä¼ æ”¯æŒ
  - âœ… è‡ªåŠ¨é‡è¯•æœºåˆ¶
  - âœ… è¿›åº¦æ˜¾ç¤º
  - âœ… é”™è¯¯å®¹é”™

#### `setup_mirror.py` - é•œåƒé…ç½®å·¥å…·
- **åŠŸèƒ½**: é…ç½®å’Œæµ‹è¯•é•œåƒæº
- **ç‰¹æ€§**:
  - âœ… å¤šé•œåƒæºæ”¯æŒ
  - âœ… è‡ªåŠ¨è¿é€šæ€§æµ‹è¯•
  - âœ… æ™ºèƒ½é•œåƒé€‰æ‹©

#### `download_models.bat` - Windowsä¸€é”®è„šæœ¬
- **åŠŸèƒ½**: Windowsç¯å¢ƒä¸€é”®ä¸‹è½½
- **ç‰¹æ€§**:
  - âœ… è‡ªåŠ¨ç¯å¢ƒæ£€æµ‹
  - âœ… è™šæ‹Ÿç¯å¢ƒæ¿€æ´»
  - âœ… ç½‘ç»œçŠ¶æ€æ£€æŸ¥

### æ‰€éœ€æ¨¡å‹åˆ—è¡¨

| æ¨¡å‹åç§° | ç”¨é€” | å¤§å° | ä¸‹è½½åœ°å€ |
|---------|------|------|---------|
| **ControlNet Canny** | è¾¹ç¼˜æ£€æµ‹æ§åˆ¶ | ~1.2GB | lllyasviel/sd-controlnet-canny |
| **Stable Diffusion v1.5** | å›¾åƒç”ŸæˆåŸºç¡€æ¨¡å‹ | ~4.2GB | runwayml/stable-diffusion-v1-5 |
| **IP-Adapter** | é£æ ¼è¿ç§» | ~1.8GB | h94/IP-Adapter |
| **CLIP Encoder** | å›¾åƒç¼–ç å™¨ | ~1.7GB | laion/CLIP-ViT-H-14-laion2B-s32B-b79K |

**æ€»ä¸‹è½½å¤§å°**: çº¦ 8.9GB

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. ç½‘ç»œè¿æ¥é—®é¢˜
```bash
# ç—‡çŠ¶ï¼šè¿æ¥è¶…æ—¶æˆ–ä¸‹è½½å¤±è´¥
# è§£å†³æ–¹æ¡ˆï¼š
python setup_mirror.py auto  # è‡ªåŠ¨é€‰æ‹©é•œåƒ
```

#### 2. ä»£ç†é…ç½®å†²çª
```bash
# ç—‡çŠ¶ï¼šä»£ç†è§£æé”™è¯¯
# è§£å†³æ–¹æ¡ˆï¼šæ¸…é™¤ä»£ç†è®¾ç½®
set http_proxy=
set https_proxy=
set all_proxy=
```

#### 3. ç£ç›˜ç©ºé—´ä¸è¶³
```bash
# ç—‡çŠ¶ï¼šä¸‹è½½ä¸­æ–­
# è§£å†³æ–¹æ¡ˆï¼šæ¸…ç†ç¼“å­˜æˆ–æ›´æ¢ç¼“å­˜ç›®å½•
export HF_HOME=/path/to/large/disk/cache
```

#### 4. æƒé™é—®é¢˜
```bash
# ç—‡çŠ¶ï¼šæ— æ³•å†™å…¥ç¼“å­˜ç›®å½•
# è§£å†³æ–¹æ¡ˆï¼š
chmod 755 ./model_cache
# æˆ–è€…æ›´æ¢åˆ°æœ‰æƒé™çš„ç›®å½•
```

### é”™è¯¯ä»£ç è¯´æ˜

| é”™è¯¯ç±»å‹ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|---------|---------|
| `ConnectionError` | ç½‘ç»œè¿æ¥é—®é¢˜ | åˆ‡æ¢é•œåƒæº |
| `HTTPError 404` | æ¨¡å‹è·¯å¾„é”™è¯¯ | æ£€æŸ¥æ¨¡å‹åç§° |
| `OSError` | ç£ç›˜ç©ºé—´/æƒé™ | æ£€æŸ¥å­˜å‚¨ç©ºé—´å’Œæƒé™ |
| `ImportError` | ä¾èµ–ç¼ºå¤± | `pip install -r requirements.txt` |

## ğŸ’¾ ç¦»çº¿éƒ¨ç½²

### æ¨¡å‹ç¼“å­˜ä½ç½®
```
model_cache/
â”œâ”€â”€ models--lllyasviel--sd-controlnet-canny/
â”œâ”€â”€ models--runwayml--stable-diffusion-v1-5/
â”œâ”€â”€ models--h94--IP-Adapter/
â””â”€â”€ models--laion--CLIP-ViT-H-14-laion2B-s32B-b79K/
```

### ç¦»çº¿ä¼ è¾“æ­¥éª¤
1. **æ‰“åŒ…æ¨¡å‹ç¼“å­˜**
   ```bash
   tar -czf models.tar.gz model_cache/
   ```

2. **ä¼ è¾“åˆ°ç›®æ ‡æœºå™¨**
   ```bash
   scp models.tar.gz user@target:/path/to/project/
   ```

3. **è§£å‹å¹¶å¯åŠ¨**
   ```bash
   tar -xzf models.tar.gz
   python start_offline.bat
   ```

## âš™ï¸ é«˜çº§é…ç½®

### ç¯å¢ƒå˜é‡é…ç½®

```bash
# é•œåƒæºè®¾ç½®
export HF_ENDPOINT=https://hf-mirror.com

# ç¼“å­˜ç›®å½•è®¾ç½®
export HF_HOME=/custom/cache/path

# ç¦»çº¿æ¨¡å¼
export HF_HUB_OFFLINE=1
export TRANSFORMERS_OFFLINE=1

# ä¸‹è½½è¶…æ—¶è®¾ç½®
export HF_HUB_DOWNLOAD_TIMEOUT=300
```

### æ‰¹é‡ä¸‹è½½é…ç½®

åˆ›å»º `download_config.py`:
```python
# è‡ªå®šä¹‰ä¸‹è½½é…ç½®
DOWNLOAD_CONFIG = {
    "cache_dir": "./custom_cache",
    "resume_download": True,
    "force_download": False,
    "local_files_only": False,
    "use_auth_token": None,
    "revision": "main"
}
```

### ç½‘ç»œä¼˜åŒ–é…ç½®

```python
# è®¾ç½®ä¸‹è½½çº¿ç¨‹æ•°
os.environ['HF_HUB_DOWNLOAD_WORKERS'] = '4'

# è®¾ç½®é‡è¯•æ¬¡æ•°
os.environ['HF_HUB_DOWNLOAD_RETRIES'] = '3'

# è®¾ç½®ç¼“å†²åŒºå¤§å°
os.environ['HF_HUB_DOWNLOAD_CHUNK_SIZE'] = '10485760'  # 10MB
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### ä¸‹è½½é€Ÿåº¦å¯¹æ¯”

| é•œåƒæº | å¹³å‡é€Ÿåº¦ | æˆåŠŸç‡ | å»¶è¿Ÿ |
|--------|---------|---------|------|
| hf-mirror | 8-15 MB/s | 95%+ | 20-50ms |
| modelscope | 5-12 MB/s | 90%+ | 30-80ms |
| official | 0.1-2 MB/s | 60%+ | 200-500ms |

### ç³»ç»Ÿè¦æ±‚

- **æœ€å°å­˜å‚¨ç©ºé—´**: 10GB
- **æ¨èå­˜å‚¨ç©ºé—´**: 20GB
- **ç½‘ç»œå¸¦å®½**: å»ºè®® 10Mbps+
- **å†…å­˜**: ä¸‹è½½æ—¶éœ€è¦ 2GB+ å¯ç”¨å†…å­˜

## ğŸ” éªŒè¯ä¸‹è½½

### å®Œæ•´æ€§æ£€æŸ¥
```bash
# æ£€æŸ¥æ¨¡å‹æ–‡ä»¶
python -c "
import os
cache_dir = './model_cache'
if os.path.exists(cache_dir):
    size = sum(os.path.getsize(os.path.join(dirpath, filename))
               for dirpath, dirnames, filenames in os.walk(cache_dir)
               for filename in filenames)
    print(f'ç¼“å­˜å¤§å°: {size / (1024**3):.2f} GB')
else:
    print('ç¼“å­˜ç›®å½•ä¸å­˜åœ¨')
"
```

### åŠŸèƒ½æµ‹è¯•
```bash
# æµ‹è¯•æ¨¡å‹åŠ è½½
python -c "
from diffusers import ControlNetModel
try:
    model = ControlNetModel.from_pretrained(
        'lllyasviel/sd-controlnet-canny',
        cache_dir='./model_cache',
        local_files_only=True
    )
    print('âœ… æ¨¡å‹åŠ è½½æˆåŠŸ')
except Exception as e:
    print(f'âŒ æ¨¡å‹åŠ è½½å¤±è´¥: {e}')
"
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è·å–å¸®åŠ©
- **é—®é¢˜åé¦ˆ**: åˆ›å»º GitHub Issue
- **æŠ€æœ¯è®¨è®º**: æŸ¥çœ‹é¡¹ç›® Wiki
- **å®æ—¶æ”¯æŒ**: é¡¹ç›®äº¤æµç¾¤

### æœ‰ç”¨çš„å‘½ä»¤
```bash
# æŸ¥çœ‹é•œåƒçŠ¶æ€
python setup_mirror.py info

# æ¸…ç†ç¼“å­˜
rm -rf model_cache/

# é‡æ–°ä¸‹è½½
python download_models.py --force-download

# æŸ¥çœ‹ä¸‹è½½æ—¥å¿—
tail -f generation.log
```

---

**æœ€åæ›´æ–°**: 2024å¹´8æœˆ
**ç‰ˆæœ¬**: v1.0
**ç»´æŠ¤è€…**: AI-TourMap-Generator Team